(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"9c249efa-f885-4658-8591-7dd611d2a961","Content-Type":"application/json"}},_=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),Q=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(_),A=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(_),X=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(_),Y=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(_),Z=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(_),ee=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(_),te=(e,t)=>fetch(`${l.baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>_(o)),oe=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),F=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,onInfoButton:n},c)=>{const s=oe(),i=s.querySelector(".card__like-button"),a=s.querySelector(".card__control-button_type_delete"),u=s.querySelector(".card__image"),I=s.querySelector(".card__like-count"),B=s.querySelector(".card__control-button_type_info");return u.src=e.link,u.alt=e.name,s.querySelector(".card__title").textContent=e.name,I.textContent=e.likes.length,s.dataset.cardId=e._id,B.dataset.id=e._id,e.likes.some(G=>G._id===c)&&i.classList.add("card__like-button_is-active"),o&&i.addEventListener("click",()=>o(i,I,s.dataset.cardId)),e.owner&&e.owner._id===c?a.addEventListener("click",()=>{r(s,e._id)}):a.remove(),t&&u.addEventListener("click",()=>t({name:e.name,link:e.link})),n&&B.addEventListener("click",()=>{n(e._id)}),s},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},ne=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})};function w(e,t,o,r){let n=e.querySelector("#"+t.id+"-error");t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)}function M(e,t,o){let r=e.querySelector("#"+t.id+"-error");t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function re(e,t,o){t.validity.valid?M(e,t,o):t.validity.patternMismatch&&t.hasAttribute("data-error-message")?w(e,t,t.dataset.errorMessage,o):w(e,t,t.validationMessage,o)}function ce(e){return e.some(function(t){return!t.validity.valid})}function T(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function se(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function P(e,t,o){ce(e)?T(t,o):se(t,o)}function le(e,t){let o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);P(o,r,t),o.forEach(function(n){n.addEventListener("input",function(){re(e,n,t),P(o,r,t)})})}function C(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(function(n){M(e,n,t),n.setCustomValidity("")}),e.reset(),T(r,t)}function ae(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(function(o){le(o,e)})}const S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ae(S);const $=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),y=v.querySelector(".popup__form"),N=y.querySelector(".popup__input_type_name"),O=y.querySelector(".popup__input_type_description"),L=document.querySelector(".popup_type_new-card"),p=L.querySelector(".popup__form"),ie=p.querySelector(".popup__input_type_card-name"),ue=p.querySelector(".popup__input_type_url"),q=document.querySelector(".popup_type_image"),U=q.querySelector(".popup__image"),de=q.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),W=document.querySelector(".popup_type_edit-avatar"),f=W.querySelector(".popup__form"),me=f.querySelector(".popup__input"),x=document.querySelector(".popup_type_remove-card"),V=x.querySelector(".popup__form");let j=null,J=null;const fe=document.getElementById("popup-info-definition-template").content,H=({name:e,link:t})=>{U.src=t,U.alt=e,de.textContent=e,m(q)},ye=e=>{e.preventDefault();const t=y.querySelector(".popup__button");t.textContent="Сохранение...",X({name:N.value,about:O.value}).then(o=>{g.textContent=o.name,E.textContent=o.about,d(v)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent="Сохранить"})},he=e=>{e.preventDefault();const t=f.querySelector(".popup__button");t.textContent="Сохранение...",Y({avatar:me.value}).then(o=>{k.style.backgroundImage=`url(${o.avatar})`,d(v)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent="Сохранить"})},Se=e=>{e.preventDefault();const t=p.querySelector(".popup__button");t.textContent="Создание...",Z({name:ie.value,link:ue.value}).then(o=>{$.prepend(F(o,{onPreviewPicture:H,onLikeIcon:(r,n,c)=>z(r,n,c),onDeleteCard:(r,n)=>{R(r,n)},onInfoButton:K},b)),p.reset(),d(L)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent="Создать"})},R=(e,t)=>{j=e,J=t,m(x)},ve=e=>{e.preventDefault();const t=V.querySelector(".popup__button");t.textContent="Удаление...",ee(J).then(()=>{j.remove(),d(x)}).catch(o=>{console.log(o)}).finally(()=>{t.textContent="Да"})},z=(e,t,o)=>{const r=e.classList.contains("card__like-button_is-active");e.disabled=!0,te(o,r).then(n=>{t.textContent=n.likes.length,e.classList.toggle("card__like-button_is-active")}).catch(n=>{console.log(n)}).finally(()=>{e.disabled=!1})},be=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),h=(e,t)=>{const o=fe.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Ce=e=>{const t=document.getElementById("popup-info-user-preview-template");if(!t){console.error("Шаблон не найден");const r=document.createElement("li");return r.textContent=e?.name||"—",r.classList.add("popup__list-item","popup__list-item_type_name"),r}if(!e||!e.name){const r=document.createElement("li");return r.textContent="—",r.classList.add("popup__list-item","popup__list-item_type_name"),r}const o=t.content.cloneNode(!0).children[0];return o.textContent=e.name,o},K=(e,t)=>{const o=document.querySelector(".popup_type_info"),r=o.querySelector(".popup__info"),n=o.querySelector(".popup__list"),c=o.querySelector(".popup__title"),s=o.querySelector(".popup__text");t.disabled=!0,c.textContent="",r.replaceChildren(),n.replaceChildren(),A().then(i=>{const a=i.find(u=>u._id===e);c.textContent="Информация о карточке",r.append(h("Описание:",a.name)),r.append(h("Дата создания:",be(new Date(a.createdAt)))),r.append(h("Владелец:",a.owner.name)),r.append(h("Количество лайков:",a.likes.length)),a.likes.length>0&&(s.textContent="Лайкнули:",a.likes.forEach(u=>{n.append(Ce(u))})),m(o)}).catch(i=>{console.log(i)}).finally(()=>{t.disabled=!1})};y.addEventListener("submit",ye);p.addEventListener("submit",Se);f.addEventListener("submit",he);pe.addEventListener("click",()=>{N.value=g.textContent,O.value=E.textContent,C(y,S),m(v)});k.addEventListener("click",()=>{f.reset(),C(f,S),m(W)});_e.addEventListener("click",()=>{p.reset(),C(p,S),m(L)});V.addEventListener("submit",ve);const Le=document.querySelectorAll(".popup");Le.forEach(e=>{ne(e)});let b;Promise.all([A(),Q()]).then(([e,t])=>{b=t._id,g.textContent=t.name,E.textContent=t.about,k.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{$.append(F(o,{onPreviewPicture:H,onLikeIcon:(r,n,c)=>z(r,n,c),onDeleteCard:(r,n)=>{R(r,n)},onInfoButton:K},b))})}).catch(e=>{console.log(e)});
